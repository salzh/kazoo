(function(e){var t=[].slice,n={};this.amplify={publish:function(r){var i=t.call(arguments,1),s;return n[r]?(e.each(n[r],function(e,t){return s=t.callback.apply(t.context,i)}),s!==!1):!0},subscribe:function(e,t,r,i){arguments.length===3&&typeof r=="number"&&(i=r,r=t,t=null),arguments.length===2&&(r=t,t=null),i=i||10,n[e]||(n[e]=[]);for(var s=n[e].length-1,o={callback:r,context:t,priority:i};s>=0;s--)if(n[e][s].priority<=i)return n[e].splice(s+1,0,o),r;return n[e].unshift(o),r},unsubscribe:function(t,r){n[t]&&e.each(n[t],function(e,s){if(s.callback===r)return n[t].splice(e,1),!1})}}})(jQuery),function(e,t,n){function r(t,r){var i=r.__amplify__?JSON.parse(r.__amplify__):{};e.store.addType(t,function(e,t,s){var o=t,u=(new Date).getTime();if(!e){o={};for(e in i)t=(t=r[e])?JSON.parse(t):{expires:-1},t.expires&&t.expires<=u?(delete r[e],delete i[e]):o[e.replace(/^__amplify__/,"")]=t.data;return r.__amplify__=JSON.stringify(i),o}e="__amplify__"+e;if(t===n){if(i[e]){t=(t=r[e])?JSON.parse(t):{expires:-1};if(!(t.expires&&t.expires<=u))return t.data;delete r[e],delete i[e]}}else t===null?(delete r[e],delete i[e]):(r[e]=JSON.stringify({data:t,expires:s.expires?u+s.expires:null}),i[e]=!0);return r.__amplify__=JSON.stringify(i),o})}e.store=function(t,n,r){var i=e.store.type;return r&&r.type&&r.type in e.store.types&&(i=r.type),e.store.types[i](t,n,r||{})},t.extend(e.store,{types:{},type:null,addType:function(n,r){this.type||(this.type=n),this.types[n]=r,e.store[n]=function(r,i,s){return e.store(r,i,t.extend({type:n},s))}}}),t.each(["localStorage","sessionStorage"],function(e,t){try{window[t].getItem&&r(t,window[t])}catch(n){}}),window.globalStorage&&r("globalStorage",window.globalStorage[window.location.hostname]),function(){var r=t("<div>").hide().appendTo("html")[0],i;r.addBehavior&&(r.addBehavior("#default#userdata"),r.load("amplify"),i=r.getAttribute("amplify")?JSON.parse(r.getAttribute("amplify")):{},e.store.addType("userData",function(e,t,s){var o=t,u=(new Date).getTime();if(!e){o={};for(e in i)t=(t=r.getAttribute(e))?JSON.parse(t):{expires:-1},t.expires&&t.expires<=u?(r.removeAttribute(e),delete i[e]):o[e]=t.data;return r.setAttribute("amplify",JSON.stringify(i)),r.save("amplify"),o}e=e.replace(/[^-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u37f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-");if(t===n){if(e in i){t=(t=r.getAttribute(e))?JSON.parse(t):{expires:-1};if(!(t.expires&&t.expires<=u))return t.data;r.removeAttribute(e),delete i[e]}}else t===null?(r.removeAttribute(e),delete i[e]):(r.setAttribute(e,JSON.stringify({data:t,expires:s.expires?u+s.expires:null})),i[e]=!0);return r.setAttribute("amplify",JSON.stringify(i)),r.save("amplify"),o}))}(),r("memory",{}),t.cookie&&t.support.cookie&&e.store.addType("cookie",function(e,n,r){return t.cookie(e,n,{expires:r.expires||99e9,path:"/"})})}(amplify,jQuery),function(e,t,n){e.request=function(n,r,i){var s=n||{};typeof s=="string"&&(t.isFunction(r)&&(i=r,r={}),s={resourceId:n,data:r||{},success:i}),n=e.request.resources[s.resourceId];var o=s.success||t.noop,u=s.error||t.noop;s.success=function(t,n){e.publish("request.success",s,t,n),e.publish("request.complete",s,t,n),o.apply(this,arguments)},s.error=function(t,n){e.publish("request.error",s,t,n),e.publish("request.complete",s,t,n),u.apply(this,arguments)};if(!n)throw s.resourceId?"amplify.request: unknown resourceId: "+s.resourceId:"amplify.request: no resourceId provided";e.publish("request.before",s)&&e.request.resources[s.resourceId](s)},t.extend(e.request,{types:{},resources:{},define:function(t,n,r){if(typeof n=="string"){if(!(n in e.request.types))throw"amplify.request.define: unknown type: "+n;r.resourceId=t,e.request.resources[t]=e.request.types[n](r)}else e.request.resources[t]=n}}),e.request.types.ajax=function(r){return r=t.extend({type:"GET"},r),function(i){var s=r.url,o=i.data,u;typeof o!="string"&&(o=t.extend(!0,{},r.data,o),t.each(o,function(e,t){u=RegExp("{"+e+"}","g"),u.test(s)&&(s=s.replace(u,t),delete o[e])})),t.ajax(t.extend({},r,{url:s,type:r.type,data:o,dataType:r.dataType,success:function(e,t,n){i.success(e,n)},error:function(e,t,r,s){s===n&&(s=null),i.error(s,e)},beforeSend:function(t,n){return(r.beforeSend?r.beforeSend.apply(this,arguments):!0)&&e.publish("request.before.ajax",r,i,n,t)}}))}};var r=e.request.cache={_key:function(e,t){function n(){return t.charCodeAt(i++)<<24|t.charCodeAt(i++)<<16|t.charCodeAt(i++)<<8|t.charCodeAt(i++)<<0}for(var r=t.length,i=0,s=n();i<r;)s^=n();return"request-"+e+"-"+s},_default:function(){var e={};return function(t,n,s){var o=r._key(t.resourceId,s.data),u=t.cache;if(o in e)return s.success(e[o]),!1;var a=s.success;s.success=function(t){e[o]=t,typeof u=="number"&&setTimeout(function(){delete e[o]},u),a.apply(this,arguments)}}}()};e.store&&(t.each(e.store.types,function(t){r[t]=function(n,s,o){var u=r._key(n.resourceId,o.data);if(n=e.store[t](u))return o.success(n),!1;var a=o.success;o.success=function(n){e.store[t](u,n),a.apply(this,arguments)}}}),r.persist=r[e.store.type]),e.subscribe("request.before.ajax",function(e){var t=e.cache;if(t)return r[t in r?t:"_default"].apply(this,arguments)}),e.request.decoders={jsend:function(e,t,n,r,i){e.status==="success"?r(e.data):e.status==="fail"?i(e.data,"fail"):e.status==="error"&&(delete e.status,i(e))}},e.subscribe("request.before.ajax",function(n,r,i){function s(e){return function(t){u(t,"success",e)}}function o(e){return function(t){a(e,"error",null,t)}}var u=i.success,a=i.error,l=t.isFunction(n.decoder)?n.decoder:n.decoder in e.request.decoders?e.request.decoders[n.decoder]:e.request.decoders._default;l&&(i.success=function(e,t,n){l(e,t,n,s(n),o(n))},i.error=function(e,t){l(null,t,e,s(e),o(e))})})}(amplify,jQuery);
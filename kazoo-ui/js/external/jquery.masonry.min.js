(function(e,t,n){var r=t.event,i;r.special.smartresize={setup:function(){t(this).bind("resize",r.special.smartresize.handler)},teardown:function(){t(this).unbind("resize",r.special.smartresize.handler)},handler:function(e,t){var n=this,r=arguments;e.type="smartresize",i&&clearTimeout(i),i=setTimeout(function(){jQuery.event.handle.apply(n,r)},t==="execAsap"?0:100)}},t.fn.smartresize=function(e){return e?this.bind("smartresize",e):this.trigger("smartresize",["execAsap"])},t.Mason=function(e,n){this.element=t(n),this._create(e),this._init()};var s=["position","height"];t.Mason.settings={isResizable:!0,isAnimated:!1,animationOptions:{queue:!1,duration:500},gutterWidth:0,isRTL:!1,isFitWidth:!1},t.Mason.prototype={_filterFindBricks:function(e){var t=this.options.itemSelector;return t?e.filter(t).add(e.find(t)):e},_getBricks:function(e){var t=this._filterFindBricks(e).css({position:"absolute"}).addClass("masonry-brick");return t},_create:function(n){this.options=t.extend(!0,{},t.Mason.settings,n),this.styleQueue=[],this.reloadItems();var r=this.element[0].style;this.originalStyle={};for(var i=0,o=s.length;i<o;i++){var u=s[i];this.originalStyle[u]=r[u]||""}this.element.css({position:"relative"}),this.horizontalDirection=this.options.isRTL?"right":"left",this.offset={};var l=t(document.createElement("div"));this.element.prepend(l),this.offset.y=Math.round(l.position().top),this.options.isRTL?(l.css({"float":"right",display:"inline-block"}),this.offset.x=Math.round(this.element.outerWidth()-l.position().left)):this.offset.x=Math.round(l.position().left),l.remove();var c=this;setTimeout(function(){c.element.addClass("masonry")},0),this.options.isResizable&&t(e).bind("smartresize.masonry",function(){c.resize()})},_init:function(e){this._getColumns("masonry"),this._reLayout(e)},option:function(e,n){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))},layout:function(e,n){var r,i,s,o,u,a;for(var f=0,l=e.length;f<l;f++){r=t(e[f]),i=Math.ceil(r.outerWidth(!0)/this.columnWidth),i=Math.min(i,this.cols);if(i===1)this._placeBrick(r,this.colYs);else{s=this.cols+1-i,o=[];for(a=0;a<s;a++)u=this.colYs.slice(a,a+i),o[a]=Math.max.apply(Math,u);this._placeBrick(r,o)}}var c={};c.height=Math.max.apply(Math,this.colYs)-this.offset.y,this.options.isFitWidth&&(c.width=this.cols*this.columnWidth-this.options.gutterWidth),this.styleQueue.push({$el:this.element,style:c});var h=this.isLaidOut?this.options.isAnimated?"animate":"css":"css",p=this.options.animationOptions,d;for(f=0,l=this.styleQueue.length;f<l;f++)d=this.styleQueue[f],d.$el[h](d.style,p);this.styleQueue=[],n&&n.call(e),this.isLaidOut=!0},_getColumns:function(){var e=this.options.isFitWidth?this.element.parent():this.element,t=e.width();this.columnWidth=this.options.columnWidth||this.$bricks.outerWidth(!0)||t,this.columnWidth+=this.options.gutterWidth,this.cols=Math.floor((t+this.options.gutterWidth)/this.columnWidth),this.cols=Math.max(this.cols,1)},_placeBrick:function(e,t){var n=Math.min.apply(Math,t),r=0;for(var i=0,s=t.length;i<s;i++)if(t[i]===n){r=i;break}var o={top:n};o[this.horizontalDirection]=this.columnWidth*r+this.offset.x,this.styleQueue.push({$el:e,style:o});var u=n+e.outerHeight(!0),a=this.cols+1-s;for(i=0;i<a;i++)this.colYs[r+i]=u},resize:function(){var e=this.cols;this._getColumns("masonry"),this.cols!==e&&this._reLayout()},_reLayout:function(e){var t=this.cols;this.colYs=[];while(t--)this.colYs.push(this.offset.y);this.layout(this.$bricks,e)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(e){this.reloadItems(),this._init(e)},appended:function(e,t,n){if(t){this._filterFindBricks(e).css({top:this.element.height()});var r=this;setTimeout(function(){r._appended(e,n)},1)}else this._appended(e,n)},_appended:function(e,t){var n=this._getBricks(e);this.$bricks=this.$bricks.add(n),this.layout(n,t)},remove:function(e){this.$bricks=this.$bricks.not(e),e.remove()},destroy:function(){this.$bricks.removeClass("masonry-brick").each(function(){this.style.position="",this.style.top="",this.style.left=""});var n=this.element[0].style;for(var r=0,i=s.length;r<i;r++){var o=s[r];n[o]=this.originalStyle[o]}this.element.unbind(".masonry").removeClass("masonry").removeData("masonry"),t(e).unbind(".masonry")}},t.fn.imagesLoaded=function(e){function t(){--o<=0&&this.src!==u&&(setTimeout(r),s.unbind("load error",t))}function r(){e.call(i,s)}var i=this,s=i.find("img").add(i.filter("img")),o=s.length,u="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";return o||r(),s.bind("load error",t).each(function(){if(this.complete||this.complete===n){var e=this.src;this.src=u,this.src=e}}),i};var o=function(e){this.console&&console.error(e)};t.fn.masonry=function(e){if(typeof e=="string"){var n=Array.prototype.slice.call(arguments,1);this.each(function(){var r=t.data(this,"masonry");if(!r)o("cannot call methods on masonry prior to initialization; attempted to call method '"+e+"'");else{if(!t.isFunction(r[e])||e.charAt(0)==="_"){o("no such method '"+e+"' for masonry instance");return}r[e].apply(r,n)}})}else this.each(function(){var n=t.data(this,"masonry");n?(n.option(e||{}),n._init()):t.data(this,"masonry",new t.Mason(e,this))});return this}})(window,jQuery);
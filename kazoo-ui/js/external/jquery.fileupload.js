(function(e){var t=0,n={bigBtnText:"Select a file",btnText:"Select a file",inputOnly:!1,multiple:!1,resultType:"[]",dataFormat:"dataURL"};e.fn.fileUpload=function(r){var i=r&&r.hasOwnProperty("success")?r.success:undefined,s=r&&r.hasOwnProperty("error")?r.error:undefined,o=e.extend({},n,r),u=e(this).css("display","none").prop("multiple",o.multiple),a=e('<div id="file_upload_wrapper_'+ ++t+'">'),f=e('<input type="text" id="file_upload_input_'+t+'">'),l=e('<button type="button" id="file_upload_button_'+t+'">'+o.btnText+"</button>"),c=e('<button type="button" id="file_upload_bigButton_'+t+'">'+o.bigBtnText+"</button>");o.hasOwnProperty("btnClass")&&l.addClass(o.btnClass),o.hasOwnProperty("inputClass")&&f.addClass(o.inputClass),o.hasOwnProperty("bigBtnClass")&&c.addClass(o.bigBtnClass),o.hasOwnProperty("wrapperClass")&&a.addClass(o.wrapperClass),o.inputOnly||o.hasOwnProperty("filesList")&&o.filesList.length>0?(o.hasOwnProperty("filesList")&&o.filesList.length>0&&f.val(o.filesList.join(", ")),a.insertAfter(u).append(u,f,l)):(a.insertAfter(u).append(u,f,l),c.insertBefore(a),a.hide(),e("body").delegate("#file_upload_bigButton_"+t,"click",function(){u.focus().trigger("click")})),a.delegate("#file_upload_button_"+t,"click",function(){u.focus().trigger("click")}),a.delegate('input[type="file"]',"change",function(e){var t=Array.prototype.slice.call(e.target.files),n=[],r=[],u=!1,h={mimeTypes:[],size:[]},p,d;o.resultType==="[]"?p=[]:o.resultType==="{}"&&(p={}),t.forEach(function(e){var t=!0;o.hasOwnProperty("mimeTypes")&&o.mimeTypes.indexOf(e.type)===-1&&(h.mimeTypes.push(e.name),u=!0,t=!1),o.hasOwnProperty("maxSize")&&e.size>o.maxSize*1e6&&(h.size.push(e.name),u=!0,t=!1),t&&(r.push(e),n.push(e.name))});if(r.length>0){var v=r.length;r.forEach(function(e){var t=new FileReader;t["readAs".concat(o.dataFormat.charAt(0).toUpperCase(),o.dataFormat.slice(1))](e),t.onloadend=function(){o.resultType==="[]"?p.push({name:e.name,file:t.result}):o.resultType==="{}"&&(p[e.name]=t.result),--v===0&&(i&&i(p),l.trigger("blur"))}}),!o.inputOnly&&c.is(":visible")&&c.fadeOut(function(){a.fadeIn()}),d=n.join(", ");if(d!=="")if(f.val()!==""){var m=f.css("color"),g=f.css("backgroundColor");f.animate({color:g},300,function(){f.val(d),f.animate({color:m},300)})}else f.val(d)}u&&(s&&s(h),c.is(":visible")?c.trigger("blur"):l.trigger("blur"))}),a.delegate("#file_upload_input_".concat(t),"blur",function(){u.trigger("blur")}),a.delegate("#file_upload_input_".concat(t),"keydown",function(e){switch(e.which){case 8:case 46:u.replaceWith(u=u.clone(!0)),u.trigger("change"),f.val("");break;case 9:return;case 13:u.trigger("click");break;default:return!1}})}})(jQuery);
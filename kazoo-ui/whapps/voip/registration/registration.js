winkstart.module("voip","registration",{css:["css/registration.css"],templates:{registration:"tmpl/registration.html"},subscribe:{"registration.activate":"activate"},resources:{"registration.list":{url:"{api_url}/accounts/{account_id}/registrations",contentType:"application/json",verb:"GET"}}},function(e){winkstart.registerResources(this.__whapp,this.config.resources),winkstart.publish("whappnav.subnav.add",{whapp:"voip",module:this.__module,label:_t("registration","registrations_label"),icon:"registration",weight:"35"})},{activate:function(e){var t=this,n=t.templates.registration.tmpl({_t:function(e){return window.translate.registration[e]}}).appendTo($("#ws-content").empty());t.setup_table(n),t.list_registrations(n),$("#refresh_registrations",n).click(function(){winkstart.table.registration.fnClearTable(),t.list_registrations(n)})},list_registrations:function(e){var t=function(e){var t="-";if(e){var n=new Date((e-62167219200)*1e3),r=n.getMonth()+1,i=n.getFullYear(),s=n.getDate(),o=r+"/"+s+"/"+i,u=n.toLocaleTimeString();t=o+" "+u}return t};winkstart.getJSON("registration.list",{account_id:winkstart.apps.voip.account_id,api_url:winkstart.apps.voip.api_url},function(n){var r=[];$.each(n.data,function(){var e=t(this.event_timestamp);this.contact=this.contact.replace(/"/g,""),this.contact=this.contact.replace(/'/g,"\\'");var n=_t("registration","details_of_registration")+"<br/>";n+="<br/>"+_t("registration","app_name")+this.app_name,n+="<br/>"+_t("registration","app_version")+this.app_version,n+="<br/>"+_t("registration","call_id")+this.call_id,n+="<br/>"+_t("registration","contact")+this.contact,n+="<br/>"+_t("registration","event_category")+this.event_category,n+="<br/>"+_t("registration","event_name")+this.event_name,n+="<br/>"+_t("registration","expires")+this.expires,n+="<br/>"+_t("registration","freeswitch_hostname")+this.freeswitch_hostname,n+="<br/>"+_t("registration","from_host")+this.from_host,n+="<br/>"+_t("registration","from_user")+this.from_user,n+="<br/>"+_t("registration","network_ip")+this.network_ip,n+="<br/>"+_t("registration","contact_ip")+this.contact_ip,n+="<br/>"+_t("registration","contact_port")+this.contact_port,n+="<br/>"+_t("registration","network_port")+this.network_port,n+="<br/>"+_t("registration","presence_hosts")+this.presence_hosts,n+="<br/>"+_t("registration","profile_name")+this.profile_name,n+="<br/>"+_t("registration","rpid")+this.rpid,n+="<br/>"+_t("registration","realm")+this.realm,n+="<br/>"+_t("registration","server_id")+this.server_id,n+="<br/>"+_t("registration","status")+this.status,n+="<br/>"+_t("registration","to_host")+this.to_host,n+="<br/>"+_t("registration","to_user")+this.to_user,n+="<br/>"+_t("registration","user_agent")+this.user_agent,n+="<br/>"+_t("registration","username")+this.username,n+="<br/>"+_t("registration","date")+e,r.push([this.username,this.contact_ip,this.contact_port,e,n])}),winkstart.table.registration.fnAddData(r),n.data.length<10&&$(".dataTables_paginate",e).hide()})},setup_table:function(e){var t=this,n=[{sTitle:_t("registration","username_stitle")},{sTitle:_t("registration","ip_stitle")},{sTitle:_t("registration","port_stitle")},{sTitle:_t("registration","date_stitle")},{sTitle:_t("registration","details_stitle"),fnRender:function(e){winkstart.log(e);var t=e.aData[e.iDataColumn];return"<a href=\"#\" onClick=\"winkstart.alert('info','"+t+"');\">"+_t("registration","details")+"</a>"}}];winkstart.table.create("registration",$("#registration-grid",e),n,{},{sDom:"frtlip",aaSorting:[[3,"desc"]]}),$("#registration-grid_filter input[type=text]",e).first().focus(),$(".cancel-search",e).click(function(){$("#registration-grid_filter input[type=text]",e).val(""),winkstart.table.registration.fnFilter("")})}});
winkstart.module("pbxs","pbxs_manager",{css:["css/pbxs_manager.css",_t("pbxs_manager","numbers_popup_css"),"css/endpoints.css"],templates:{pbxs_manager:"tmpl/pbxs_manager.html",failover_dialog:"tmpl/failover_dialog.html",cnam_dialog:"tmpl/cnam_dialog.html",e911_dialog:"tmpl/e911_dialog.html",assign_number_dialog:"tmpl/assign_number_dialog.html",move_number_dialog:"tmpl/move_number_dialog.html",add_number_dialog:"tmpl/add_number_dialog.html",add_number_search_results:"tmpl/add_number_search_results.html",endpoint:"tmpl/endpoint.html",endpoint_numbers:"tmpl/endpoint_numbers.html"},subscribe:{"pbxs_manager.activate":"activate","pbxs_manager.edit":"edit_server"},resources:{"pbxs_manager.list_callflows":{url:"{api_url}/accounts/{account_id}/callflows",contentType:"application/json",verb:"GET"},"pbxs_manager.get_account":{url:"{api_url}/accounts/{account_id}",contentType:"application/json",verb:"GET"},"pbxs_manager.list_numbers":{url:"{api_url}/accounts/{account_id}/phone_numbers",contentType:"application/json",verb:"GET"},"pbxs_manager.get":{url:"{api_url}/accounts/{account_id}/phone_numbers/{phone_number}",contentType:"application/json",verb:"GET"},"pbxs_manager.update":{url:"{api_url}/accounts/{account_id}/phone_numbers/{phone_number}",contentType:"application/json",verb:"POST"},"pbxs_manager.activate":{url:"{api_url}/accounts/{account_id}/phone_numbers/{phone_number}/activate",contentType:"application/json",verb:"PUT"},"pbxs_manager.search":{url:"{api_url}/phone_numbers?prefix={prefix}&quantity={quantity}",contentType:"application/json",verb:"GET"},"pbxs_manager.delete":{url:"{api_url}/accounts/{account_id}/phone_numbers/{phone_number}",contentType:"application/json",verb:"DELETE"},"pbxs_manager.create":{url:"{api_url}/accounts/{account_id}/phone_numbers/{phone_number}/docs/{file_name}",contentType:"application/x-base64",verb:"PUT"},"old_trunkstore.create":{url:"{api_url}/accounts/{account_id}/connectivity",contentType:"application/json",verb:"PUT"},"old_trunkstore.list":{url:"{api_url}/accounts/{account_id}/connectivity",contentType:"application/json",verb:"GET"},"old_trunkstore.get":{url:"{api_url}/accounts/{account_id}/connectivity/{connectivity_id}",contentType:"application/json",verb:"GET"},"old_trunkstore.update":{url:"{api_url}/accounts/{account_id}/connectivity/{connectivity_id}",contentType:"application/json",verb:"POST"}}},function(e){var t=this;winkstart.registerResources(t.__whapp,t.config.resources)},{list_available_pbxs:function(){return["allworks","altigen","asterisk","avaya","bluebox","cisco","digium","epygi","freepbx","freeswitch","mitel","objectworld","other","pingtel","responsepoint","samsung","shoretel","sutus","talkswitch","threecom","taridium"]},list_all_numbers:function(e,t){winkstart.request("pbxs_manager.list_numbers",{account_id:winkstart.apps.pbxs.account_id,api_url:winkstart.apps.pbxs.api_url},function(t,n){typeof e=="function"&&e(t,n)},function(e,n){typeof t=="function"&&t(e,n)})},list_callflows:function(e,t){winkstart.request("pbxs_manager.list_callflows",{account_id:winkstart.apps.pbxs.account_id,api_url:winkstart.apps.pbxs.api_url},function(t,n){typeof e=="function"&&e(t,n)},function(e,n){typeof t=="function"&&t(e,n)})},create_account:function(e,t){winkstart.request("pbxs_manager.get_account",{account_id:winkstart.apps.pbxs.account_id,api_url:winkstart.apps.pbxs.api_url},function(n,r){var i=this,s={account:{credits:{prepay:"0.00"},trunks:"0",inbound_trunks:"0",auth_realm:n.data.realm},billing_account_id:winkstart.apps.pbxs.account_id,DIDs_Unassigned:{},servers:[]};winkstart.request("old_trunkstore.create",{account_id:winkstart.apps.pbxs.account_id,api_url:winkstart.apps.pbxs.api_url,data:s},function(t,n){typeof e=="function"&&e(t,n)},function(e,n){typeof t=="function"&&t(e,n)})})},list_accounts:function(e,t){winkstart.request("old_trunkstore.list",{account_id:winkstart.apps.pbxs.account_id,api_url:winkstart.apps.pbxs.api_url},function(t,n){typeof e=="function"&&e(t,n)},function(e,n){typeof t=="function"&&t(e,n)})},get_account:function(e,t){var n=this;winkstart.request("old_trunkstore.get",{account_id:winkstart.apps.pbxs.account_id,api_url:winkstart.apps.pbxs.api_url,connectivity_id:winkstart.apps.pbxs.connectivity_id},function(t,n){typeof e=="function"&&e(t,n)},function(e,n){typeof t=="function"&&t(e,n)})},list_servers:function(e,t){var n=this,r=function(){n.get_account(function(t,n){e(t.data.servers,n)})};n.list_accounts(function(e,t){e.data.length?(winkstart.apps.pbxs.connectivity_id=e.data[0],r()):n.create_account(function(e){n.list_accounts(function(e,t){winkstart.apps.pbxs.connectivity_id=e.data[0],r()})},function(e,t){t==400&&e.message.match(/credit\ card/)?alert(_t("pbxs_manager","whoops_it_appears_you_have_no_credit")):alert(_t("pbxs_manager","an_error_occurred_during")+t+")")})})},edit_server:function(e,t,n,r,i){var s=this,o=t||$("#pbxs_manager-content"),u=n||$("#pbxs_manager-view",o),r=r||{},a={save_success:r.save_success||function(t){s.render_list(o),s.edit_server({id:e.id===0||e.id?e.id:t.data.servers.length-1},o,u,a)},save_error:r.save_error,delete_success:r.delete_success||function(){u.empty(),s.render_list(o)},delete_error:r.delete_error,after_render:r.after_render};s.get_account(function(t,n){winkstart.request("pbxs_manager.get_account",{account_id:winkstart.apps.pbxs.account_id,api_url:winkstart.apps.pbxs.api_url},function(n,r){var o=$.extend(!0,{auth:{},options:{e911_info:{}},extra:{realm:n.data.realm,id:e.id||(e.id===0?0:"new")}},i||{});typeof e!="object"||!e.id&&e.id!==0?s.render_endpoint(t,o,u,a):s.render_pbxs_manager(t,$.extend(!0,o,t.data.servers[e.id]),u,a)})})},get_number:function(e,t,n){winkstart.request("pbxs_manager.get",{api_url:winkstart.apps.pbxs.api_url,account_id:winkstart.apps.pbxs.account_id,phone_number:encodeURIComponent(e)},function(e,n){typeof t=="function"&&t(e)},function(e,t){typeof n=="function"&&n(e)})},update_number:function(e,t,n,r){winkstart.request("pbxs_manager.update",{api_url:winkstart.apps.pbxs.api_url,account_id:winkstart.apps.pbxs.account_id,phone_number:encodeURIComponent(e),data:t},function(e,t){typeof n=="function"&&n(e)},function(e,t){typeof r=="function"&&r(e)})},clean_phone_number_data:function(e){"failover"in e&&"sip"in e.failover&&e.failover.sip===""&&delete e.failover.sip,"failover"in e&&"e164"in e.failover&&e.failover.e164===""&&delete e.failover.e164,e.failover&&$.isEmptyObject(e.failover)&&delete e.failover,"cnam"in e&&"display_name"in e.cnam&&e.cnam.display_name===""&&delete e.cnam.display_name,e.cnam&&$.isEmptyObject(e.cnam)&&delete e.cnam},clean_form_data:function(e){return delete e.serverid,delete e.extra,e},save_endpoint:function(e,t,n,r){var i=this,s=e.extra.serverid,o=$.extend(!0,{},t.data);i.clean_form_data(e),e.server_name?(!s&&s!==0||s=="new"?o.servers.push($.extend(!0,{DIDs:{},options:{enabled:!0,inbound_format:"e.164",international:!1,caller_id:{},e911_info:{},failover:{}},permissions:{users:[]},monitor:{monitor_enabled:!1}},e)):$.extend(!0,o.servers[s],e),i.update_old_trunkstore(o,n,r)):winkstart.alert(_t("pbxs_manager","you_need_to_specify_a_name"))},normalize_data:function(e){var t=this;return $.each(e.servers,function(t,n){delete e.servers[t][""],$.each(n.DIDs,function(n,r){$.each(r,function(r,i){i===!1&&delete e.servers[t].DIDs[n][r]})});if(typeof e.servers[t].options.flags=="string"){e.servers[t].options.flags=e.servers[t].options.flags.split(/,\s*/);var r=[];$.each(e.servers[t].options.flags,function(e,t){t.replace(/\s/g,"")!==""&&r.push(t)}),e.servers[t].options.flags=r}}),e},update_old_trunkstore:function(e,t,n){var r=this;r.normalize_data(e),winkstart.request("old_trunkstore.update",{account_id:winkstart.apps.pbxs.account_id,api_url:winkstart.apps.pbxs.api_url,connectivity_id:winkstart.apps.pbxs.connectivity_id,data:e},function(e,n){typeof t=="function"&&t(e,n)},function(e,t){typeof n=="function"&&n(e,t)})},popup_endpoint_settings:function(e,t,n){var r=this,i=winkstart.dialog($('<div class="inline_popup"><div class="inline_content main_content"/></div>'),{title:_t("pbxs_manager","edit_settings_of_title")+t.server_name,position:["center",100]});r.render_endpoint(e,t,$(".main_content",i),{save_success:function(e){i.dialog("close"),n&&typeof n.save_success=="function"&&n.save_success(e)},delete_success:function(){i.dialog("close"),n&&typeof n.delete_success=="function"&&n.delete_success()}})},render_endpoint:function(e,t,n,r){t.server_name||(t.server_name=null),t._t=function(e){return window.translate.pbxs_manager[e]};var i=this,s=t,o;s.options.inbound_format=s.options.inbound_format=="e.164"?"e164":s.options.inbound_format,s.options.flags="flags"in s.options&&typeof s.options.flags=="object"?s.options.flags.join(", "):"",o=i.templates.endpoint.tmpl(s),$.each($(".pbxs .pbx",o),function(){if($(this).dataset("pbx_name")===t.server_type)return $(this).addClass("selected"),$(".pbxs .pbx:not(.selected)",o).css("opacity","0.5"),!1}),t.server_type&&$(".pbxs .pbx.selected",o).size()===0&&($(".pbxs .pbx.other",o).addClass("selected"),$(".pbxs .pbx:not(.selected)",o).css("opacity","0.5")),t.server_type||$(".info_pbx",o).hide(),$(".endpoint.edit",o).click(function(e){e.preventDefault();var n=form2object("endpoint");n.server_type=$(".pbxs .selected",o).dataset("pbx_name"),n.server_type==="other"&&(n.server_type=$("#other_name",o).val()),n.options.inbound_format=="e164"&&t.options.inbound_format=="e.164"&&(n.options.inbound_format="e.164"),n.auth.auth_method=o.find('#endpoint input[name="auth.auth_method"]:checked').val(),n.auth.auth_method.toLowerCase()==="ip"?(n.options.ip=n.auth.ip,delete n.auth.auth_user,delete n.auth.auth_password):(delete n.options.ip,delete n.auth.ip),i.get_account(function(e){i.save_endpoint(n,e,function(e){typeof r.save_success=="function"&&r.save_success(e)})})}),$(".endpoint.delete",o).click(function(n){n.preventDefault(),e.data.servers.splice(t.extra.id,1),i.update_old_trunkstore(e.data,r.delete_success)}),$(".pbxs .pbx",o).click(function(){$(".info_pbx",o).show(),$(".pbxs .pbx",o).removeClass("selected").css("opacity","0.5"),$(this).addClass("selected"),$(".selected_pbx_block",o).slideDown("fast"),$(".selected_pbx",o).html($(".pbxs .selected",o).dataset("pbx_name")),$(this).hasClass("other")?($(".selected_pbx_block",o).hide(),$(".other_name_wrapper",o).slideDown(),$("#other_name",o).focus()):($(".other_name_wrapper",o).hide(),$(".selected_pbx_block",o).slideDown(),$('input[name="auth.auth_user"]',o).focus())}),"auth"in s&&"auth_method"in s.auth&&s.auth.auth_method.toLowerCase()==="ip"?o.find("#auth_username_inputs").hide():o.find("#auth_ip_inputs").hide(),o.find('input[name="auth.auth_method"]').change(function(){var e=$(this).data("type");o.find(".auth-inputs").slideUp(function(){o.find("#auth_"+e+"_inputs").slideDown()})}),n.empty().append(o),$(".pbxs",o).animate({scrollLeft:0},0);var u=(t.server_type||"other").replace(/\.|\s/g,"").toLowerCase();$.inArray(u,i.list_available_pbxs())<0?u="other":!0;var a=$(".pbxs",o).offset().left,f=t.server_type?$(".pbxs ."+u,o).offset().left:a;$(".pbxs",o).animate({scrollLeft:f-a},0)},render_pbxs_manager:function(e,t,n,r){t._t=function(e){return window.translate.pbxs_manager[e]};var i=this,s=i.templates.endpoint_numbers.tmpl(t),o=t.extra.id;i.setup_table(s),$("#select_all_numbers",s).click(function(){$(".select_number",s).prop("checked",$(this).is(":checked"))}),$(".detail_pbx",s).click(function(){i.popup_endpoint_settings(e,t,r)}),$("#assign_number",s).click(function(){i.render_assign_number_dialog(o,function(){i.list_numbers_by_pbx(o)})}),$("#move_numbers",s).click(function(e){var t=[];$(".select_number:checked",s).each(function(){t.push($(this).parents("tr").attr("id"))}),i.get_account(function(e){i.render_move_number_dialog(t,e,o,function(){i.list_numbers_by_pbx(o)})})}),$(s).delegate(".failover","click",function(){var e=$(this),t=e.parents("tr").first().attr("id"),n=t.match(/^\+(.*)$/);n[1]&&i.get_number(n[1],function(t){i.render_failover_dialog(t.data.failover||{},function(r){t.data.failover=$.extend({},t.data.failover,r),"sip"in r?delete t.data.failover.e164:"e164"in r&&delete t.data.failover.sip,i.clean_phone_number_data(t.data),winkstart.confirm(_t("pbxs_manager","your_on_file_credit_card_will_immediately"),function(){i.update_number(n[1],t.data,function(n){$.isEmptyObject(t.data.failover)?e.removeClass("active").addClass("inactive"):e.removeClass("inactive").addClass("active")},function(e){winkstart.alert(_t("pbxs_manager","failed_to_update_the_failover")+e.message)})})})})}),$(s).delegate(".cid","click",function(){var e=$(this),t=e.parents("tr").first().attr("id"),n=t.match(/^\+(.*)$/);n[1]&&i.get_number(n[1],function(t){i.render_cnam_dialog(t.data.cnam||{},function(r){t.data.cnam=$.extend({},t.data.cnam,r),i.clean_phone_number_data(t.data),winkstart.confirm(_t("pbxs_manager","your_on_file_credit_card_will_immediately"),function(){i.update_number(n[1],t.data,function(n){$.isEmptyObject(t.data.cnam)?e.removeClass("active").addClass("inactive"):e.removeClass("inactive").addClass("active")},function(e){winkstart.alert(_t("pbxs_manager","failed_to_update_the_caller_id")+e.message)})})})})}),$(s).delegate(".e911","click",function(){var e=$(this),t=e.parents("tr").first().attr("id"),n=t.match(/^\+(.*)$/);n[1]&&i.get_number(n[1],function(t){i.render_e911_dialog(t.data.dash_e911||{},function(r){t.data.dash_e911=$.extend({},t.data.dash_e911,r),i.clean_phone_number_data(t.data),winkstart.confirm(_t("pbxs_manager","your_on_file_credit_card_will_immediately"),function(){i.update_number(n[1],t.data,function(n){$.isEmptyObject(t.data.dash_e911)?e.removeClass("active").addClass("inactive"):e.removeClass("inactive").addClass("active")},function(e){winkstart.alert(_t("pbxs_manager","failed_to_update_the_e911")+e.message)})})})})}),$("#delete_number",s).click(function(){var e,t,n=$(".select_number:checked",s),r=n.size();r>0?winkstart.confirm(_t("pbxs_manager","are_you_sure_you_want_to_remove")+r+_t("pbxs_manager","numbers_selected_from_this_pbx"),function(){var r=[];n.each(function(){e=$(this).parents("tr").attr("id"),t=e.match(/^\+(.*)$/),t[1]&&r.push("+"+t[1])}),i.get_account(function(e){$.each(r,function(t,n){n in e.data.servers[o].DIDs&&delete e.data.servers[o].DIDs[n]}),i.update_old_trunkstore(e.data,function(){i.list_numbers_by_pbx(o)},function(){i.list_numbers_by_pbx(o)})})},function(){}):winkstart.alert(_t("pbxs_manager","you_didnt_select"))}),i.list_numbers_by_pbx(o,function(){(n||$("#pbxs_manager-content")).empty().append(s)})},render_cnam_dialog:function(e,t){e._t=function(e){return window.translate.pbxs_manager[e]};var n=this,r=n.templates.cnam_dialog.tmpl(e||{}),i;$(".submit_btn",r).click(function(e){e.preventDefault();var n=form2object("cnam");typeof t=="function"&&t(n),i.dialog("close")}),i=winkstart.dialog(r,{title:_t("pbxs_manager","edit_cid_title")})},render_move_number_dialog:function(e,t,n,r){var i=this,s,o={};$.each(t.data.servers,function(e,t){e!=n&&(o[e]=t)});var u=i.templates.move_number_dialog.tmpl({servers:o,_t:function(e){return window.translate.pbxs_manager[e]}});$(".move",u).click(function(t){t.preventDefault();var o=parseInt($("#select_pbxs option:selected",u).val());i.get_account(function(t){$.each(e,function(e,r){t.data.servers[o].DIDs[r]=t.data.servers[n].DIDs[r],delete t.data.servers[n].DIDs[r]}),i.update_old_trunkstore(t.data,function(){typeof r=="function"&&r(),s.dialog("close")})})}),s=winkstart.dialog(u,{title:_t("pbxs_manager","move_selected_numbers_title")})},render_assign_number_dialog:function(e,t){var n=this,r=n.templates.assign_number_dialog.tmpl({_t:function(e){return window.translate.pbxs_manager[e]}}),i;n.setup_assign_number_table(r),$(".submit_btn",r).click(function(s){s.preventDefault();var o=[];$("#assign_number-grid .select_number:checked",r).each(function(){o.push($(this).parents("tr").first().attr("id"))}),n.get_account(function(r){$.each(o,function(t,n){r.data.servers[e].DIDs[n]={}}),n.update_old_trunkstore(r.data,function(){typeof t=="function"&&t(),i.dialog("close")})})}),n.list_available_numbers(function(){i=winkstart.dialog(r,{title:_t("pbxs_manager","assign_your_available_phone_title")})})},render_failover_dialog:function(e,t){var n=this,r={radio:(e||{}).e164?"number":(e||{}).sip?"sip":"",failover:(e||{}).e164||(e||{}).sip||"",phone_number:e.phone_number||"",_t:function(e){return window.translate.pbxs_manager[e]}},i=n.templates.failover_dialog.tmpl(r),s,o,u=e.phone_number?_t("pbxs_manager","setup_failover_for")+e.phone_number:_t("pbxs_manager","setup_failover");$('.radio_block input[type="radio"]',i).click(function(){$('.radio_block input[type="text"]',i).hide(),$(this).siblings('input[type="text"]').show("fast"),$(".header",i).removeClass("number sip").addClass($('.radio_block input[type="radio"]:checked',i).val())}),$(".submit_btn",i).click(function(e){e.preventDefault();var n={};n.raw_input=$('input[name="failover_type"]:checked',i).val()==="number"?$(".failover_number",i).val():$(".failover_sip",i).val(),n.raw_input.match(/^sip:/)?n.sip=n.raw_input:(o=n.raw_input.replace(/-|\(|\)|\s/g,"").match(/^\+(.*)$/))?n.e164="+"+o[1]:n.e164="",delete n.raw_input,n.e164||n.sip?(typeof t=="function"&&t(n),s.dialog("close")):winkstart.alert(_t("pbxs_manager","invalid_failover_number"))}),$(".remove_failover",i).click(function(e){e.preventDefault(),typeof t=="function"&&t({e164:"",sip:""}),s.dialog("close")}),s=winkstart.dialog(i,{title:u,width:"640px"})},render_e911_dialog:function(e,t){e._t=function(e){return window.translate.pbxs_manager[e]};var n=this,r=n.templates.e911_dialog.tmpl(e||{}),i;$("#postal_code",r).blur(function(){$.getJSON("http://www.geonames.org/postalCodeLookupJSON?&country=US&callback=?",{postalcode:$(this).val()},function(e){e&&e.postalcodes.length&&e.postalcodes[0].placeName&&($("#locality",r).val(e.postalcodes[0].placeName),$("#region",r).val(e.postalcodes[0].adminName1))})}),$(".inline_field > input",r).keydown(function(){$(".gmap_link_div",r).hide()});if(e.latitude&&e.longitude){var s="http://maps.google.com/maps?q="+e.latitude+",+"+e.longitude+"+(Your+E911+Location)&iwloc=A&hl=en";$("#gmap_link",r).attr("href",s),$(".gmap_link_div",r).show()}$(".submit_btn",r).click(function(e){e.preventDefault();var n=form2object("e911");typeof t=="function"&&t(n),i.dialog("close")}),i=winkstart.dialog(r,{title:e.phone_number?_t("pbxs_manager","edit_location_for")+e.phone_number:_t("pbxs_manager","edit_911_location"),width:"465px"})},render_list:function(e){var t=this,e=e||$("#ws-content");t.list_servers(function(n,r){var i=function(e){var t=[];if(e.length>0){var n=0;$.each(e,function(e,r){t.push({id:n,title:r.server_name||_t("pbxs_manager","no_name")}),n++})}return t.sort(function(e,t){return e.title.toLowerCase()<t.title.toLowerCase()?-1:1}),t};$("#pbxs_manager-listpanel",e).empty().listpanel({label:_t("pbxs_manager","pbxs_label"),identifier:"pbxs_manager-listview",new_entity_label:_t("pbxs_manager","add_server_label"),data:i(n),publisher:winkstart.publish,notifyMethod:"pbxs_manager.edit",notifyCreateMethod:"pbxs_manager.edit",notifyParent:e}),$.each(n,function(n,r){var i=r.server_type?r.server_type.replace(".","").toLowerCase():"other";$.inArray(i,t.list_available_pbxs())<0?i="other":!0,$("#"+n,$("#pbxs_manager-listpanel",e)).prepend('<span><img class="img_style" src="whapps/pbxs/pbxs_manager/css/images/endpoints/'+i+'.png" height="44" width=62"/></span>')})})},activate:function(e){var t=this,n=t.templates.pbxs_manager.tmpl();(e||$("#ws-content")).empty().append(n),t.render_list(n)},list_numbers_by_pbx:function(e,t){var n=this;(e||e>-1)&&n.list_all_numbers(function(r){n.get_account(function(n){winkstart.table.pbxs_manager.fnClearTable();var i=[],s,o,u;"numbers"in r.data&&$.each(n.data.servers[e].DIDs,function(e,t){r.data.numbers[e]&&(s=$.inArray("cnam",r.data.numbers[e].features)>-1?!0:!1,u=$.inArray("failover",r.data.numbers[e].features)>-1?!0:!1,o=$.inArray("dash_e911",r.data.numbers[e].features)>-1?!0:!1,winkstart.config.hasOwnProperty("hide_e911")&&winkstart.config.hide_e911===!0?i.push(["lol",e,u,s,r.data.numbers[e].state]):i.push(["lol",e,u,s,o,r.data.numbers[e].state]))}),winkstart.table.pbxs_manager.fnAddData(i),typeof t=="function"&&t()})})},list_available_numbers:function(e){var t=this;t.list_all_numbers(function(n){t.get_account(function(r){t.list_callflows(function(t){winkstart.table.assign_number.fnClearTable();var i=[];$.each(r.data.servers,function(e,t){$.each(this.DIDs,function(e,t){delete n.data.numbers[e]})}),$.each(t.data,function(e,t){this.numbers&&$.each(this.numbers,function(e,t){delete n.data.numbers[t]})}),"numbers"in n.data&&$.each(n.data.numbers,function(e,t){i.push(["lol",e])}),winkstart.table.assign_number.fnAddData(i),typeof e=="function"&&e()})})})},setup_assign_number_table:function(e){var t=this,n=e,r=[{sTitle:'<input type="checkbox" id="select_all_numbers"/>',fnRender:function(e){return'<input type="checkbox" class="select_number"/>'},bSortable:!1},{sTitle:_t("pbxs_manager","phone_number_stitle")}];winkstart.table.create("assign_number",$("#assign_number-grid",n),r,{},{sDom:"frtlip",aaSorting:[[1,"desc"]],fnRowCallback:function(e,t,n){return $(e).attr("id",t[1]),e}}),$("#assign_number-grid_filter input[type=text]",n).first().focus(),$(".cancel-search",n).click(function(){$("#assign_number-grid_filter input[type=text]",n).val(""),winkstart.table.assign_number.fnFilter("")}),$("#select_all_numbers",n).click(function(){$(".select_number",n).prop("checked",$(this).is(":checked"))})},setup_table:function(e){var t=this,n=e,r=[];r.push({sTitle:'<input type="checkbox" id="select_all_numbers"/>',fnRender:function(e){return'<input type="checkbox" class="select_number"/>'},bSortable:!1}),r.push({sTitle:_t("pbxs_manager","phone_number_stitle")}),r.push({sTitle:_t("pbxs_manager","failover_stitle"),fnRender:function(e){var t="failover "+(e.aData[e.iDataColumn]?"active":"inactive");return'<a class="'+t+'">'+_t("pbxs_manager","failover")+"</a>"},bSortable:!1}),r.push({sTitle:_t("pbxs_manager","caller_id_stitle"),fnRender:function(e){var t="cid "+(e.aData[e.iDataColumn]?"active":"inactive");return'<a class="'+t+'">CID</a>'},bSortable:!1}),(!winkstart.config.hasOwnProperty("hide_e911")||winkstart.config.hide_e911===!1)&&r.push({sTitle:"E911",fnRender:function(e){var t="e911 "+(e.aData[e.iDataColumn]?"active":"inactive");return'<a class="'+t+'">E911</a>'},bSortable:!1}),r.push({sTitle:_t("pbxs_manager","state_stitle"),fnRender:function(e){var t=e.aData[e.iDataColumn].replace("_"," ");return t.charAt(0).toUpperCase()+t.substr(1)}}),winkstart.table.create("pbxs_manager",$("#pbxs_manager-grid",n),r,{},{sDom:'<"action_number">frtlip',aaSorting:[[1,"desc"]],fnRowCallback:function(e,t,n){return $(e).attr("id",t[1]),e}}),$("#pbxs_manager-grid_filter input[type=text]",n).first().focus(),$(".cancel-search",n).click(function(){$("#pbxs_manager-grid_filter input[type=text]",n).val(""),winkstart.table.pbxs_manager.fnFilter("")})}});
(function(e,t,n){e.request=function(n,r,i){var s=n||{};typeof s=="string"&&(t.isFunction(r)&&(i=r,r={}),s={resourceId:n,data:r||{},success:i}),n=e.request.resources[s.resourceId];var o=s.success||t.noop,u=s.error||t.noop;s.success=function(t,n){e.publish("request.success",s,t,n),e.publish("request.complete",s,t,n),o.apply(this,arguments)},s.error=function(t,n){e.publish("request.error",s,t,n),e.publish("request.complete",s,t,n),u.apply(this,arguments)};if(!n)throw s.resourceId?"amplify.request: unknown resourceId: "+s.resourceId:"amplify.request: no resourceId provided";e.publish("request.before",s)&&e.request.resources[s.resourceId](s)},t.extend(e.request,{types:{},resources:{},define:function(t,n,r){if(typeof n=="string"){if(!(n in e.request.types))throw"amplify.request.define: unknown type: "+n;r.resourceId=t,e.request.resources[t]=e.request.types[n](r)}else e.request.resources[t]=n}}),e.request.types.ajax=function(r){return r=t.extend({type:"GET"},r),function(i){var s=r.url,u=i.data,f;typeof u!="string"&&(u=t.extend(!0,{},r.data,u),t.each(u,function(e,t){f=RegExp("{"+e+"}","g"),f.test(s)&&(s=s.replace(f,t),delete u[e])})),t.ajax(t.extend({},r,{url:s,type:r.type,data:u,dataType:r.dataType,success:function(e,t,n){i.success(e,n)},error:function(e,t,r,s){s===n&&(s=null),i.error(s,e)},beforeSend:function(t,n){return(r.beforeSend?r.beforeSend.apply(this,arguments):!0)&&e.publish("request.before.ajax",r,i,n,t)}}))}};var r=e.request.cache={_key:function(e,t){function n(){return t.charCodeAt(i++)<<24|t.charCodeAt(i++)<<16|t.charCodeAt(i++)<<8|t.charCodeAt(i++)<<0}for(var r=t.length,i=0,s=n();i<r;)s^=n();return"request-"+e+"-"+s},_default:function(){var e={};return function(t,n,i){var s=r._key(t.resourceId,i.data),o=t.cache;if(s in e)return i.success(e[s]),!1;var u=i.success;i.success=function(t){e[s]=t,typeof o=="number"&&setTimeout(function(){delete e[s]},o),u.apply(this,arguments)}}}()};e.store&&(t.each(e.store.types,function(t){r[t]=function(n,i,s){var o=r._key(n.resourceId,s.data);if(n=e.store[t](o))return s.success(n),!1;var u=s.success;s.success=function(n){e.store[t](o,n),u.apply(this,arguments)}}}),r.persist=r[e.store.type]),e.subscribe("request.before.ajax",function(e){var t=e.cache;if(t)return r[t in r?t:"_default"].apply(this,arguments)}),e.request.decoders={jsend:function(e,t,n,r,i){e.status==="success"?r(e.data):e.status==="fail"?i(e.data,"fail"):e.status==="error"&&(delete e.status,i(e))}},e.subscribe("request.before.ajax",function(n,r,i){function s(e){return function(t){u(t,"success",e)}}function o(e){return function(t){a(e,"error",null,t)}}var u=i.success,a=i.error,f=t.isFunction(n.decoder)?n.decoder:n.decoder in e.request.decoders?e.request.decoders[n.decoder]:e.request.decoders._default;f&&(i.success=function(e,t,n){f(e,t,n,s(n),o(n))},i.error=function(e,t){f(null,t,e,s(e),o(e))})})})(amplify,jQuery);
(function(e,t,n){e.request=function(n,r,i){var s=n||{};typeof s=="string"&&(t.isFunction(r)&&(i=r,r={}),s={resourceId:n,data:r||{},success:i});var o=e.request.resources[s.resourceId],u=s.success||t.noop,a=s.error||t.noop;s.success=function(t,n){e.publish("request.success",s,t,n),e.publish("request.complete",s,t,n),u.apply(this,arguments)},s.error=function(t,n){e.publish("request.error",s,t,n),e.publish("request.complete",s,t,n),a.apply(this,arguments)};if(!o)throw s.resourceId?"amplify.request: unknown resourceId: "+s.resourceId:"amplify.request: no resourceId provided";e.publish("request.before",s)&&e.request.resources[s.resourceId](s)},t.extend(e.request,{types:{},resources:{},define:function(t,n,r){if(typeof n=="string"){if(!(n in e.request.types))throw"amplify.request.define: unknown type: "+n;r.resourceId=t,e.request.resources[t]=e.request.types[n](r)}else e.request.resources[t]=n}}),e.request.types.ajax=function(r){return r=t.extend({type:"GET"},r),function(i){var s=r.url,o=i.data,u,a;typeof o!="string"&&(o=t.extend(!0,{},r.data,o),t.each(o,function(e,t){a=new RegExp("{"+e+"}","g"),a.test(s)&&(s=s.replace(a,t),delete o[e])})),t.ajax(t.extend({},r,{url:s,type:r.type,data:o,dataType:r.dataType,success:function(e,t,n){i.success(e,n)},error:function(e,t,r,s){s===n&&(s=null),i.error(s,e)},beforeSend:function(t,n){var s=r.beforeSend?r.beforeSend.apply(this,arguments):!0;return s&&e.publish("request.before.ajax",r,i,n,t)}}))}};var r=e.request.cache={_key:function(e,t){function s(){return t.charCodeAt(r++)<<24|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<0}var n=t.length,r=0,i=s();while(r<n)i^=s();return"request-"+e+"-"+i},_default:function(){var e={};return function(t,n,i){var s=r._key(t.resourceId,i.data),o=t.cache;if(s in e)return i.success(e[s]),!1;var u=i.success;i.success=function(t){e[s]=t,typeof o=="number"&&setTimeout(function(){delete e[s]},o),u.apply(this,arguments)}}}()};e.store&&(t.each(e.store.types,function(t){r[t]=function(n,i,s){var o=r._key(n.resourceId,s.data),u=e.store[t](o);if(u)return s.success(u),!1;var a=s.success;s.success=function(n){e.store[t](o,n),a.apply(this,arguments)}}}),r.persist=r[e.store.type]),e.subscribe("request.before.ajax",function(e){var t=e.cache;if(t)return r[t in r?t:"_default"].apply(this,arguments)}),e.request.decoders={jsend:function(e,t,n,r,i){e.status==="success"?r(e.data):e.status==="fail"?i(e.data,"fail"):e.status==="error"&&(delete e.status,i(e))}},e.subscribe("request.before.ajax",function(n,r,i){function a(e){return function(t){s(t,"success",e)}}function f(e){return function(t){o(e,"error",null,t)}}var s=i.success,o=i.error,u=t.isFunction(n.decoder)?n.decoder:n.decoder in e.request.decoders?e.request.decoders[n.decoder]:e.request.decoders._default;if(!u)return;i.success=function(e,t,n){u(e,t,n,a(n),f(n))},i.error=function(e,t){u(null,t,e,a(e),f(e))}})})(amplify,jQuery);
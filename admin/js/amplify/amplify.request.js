(function(e,t){function n(){}function r(e){return{}.toString.call(e)==="[object Function]"}e.request=function(t,i,s){var o=t||{};typeof o=="string"&&(r(i)&&(s=i,i={}),o={resourceId:t,data:i||{},success:s});var u={abort:n},a=e.request.resources[o.resourceId],f=o.success||n,l=o.error||n;o.success=function(t,n){n=n||"success",e.publish("request.success",o,t,n),e.publish("request.complete",o,t,n),f(t,n)},o.error=function(t,n){n=n||"error",e.publish("request.error",o,t,n),e.publish("request.complete",o,t,n),l(t,n)};if(!a)throw o.resourceId?"amplify.request: unknown resourceId: "+o.resourceId:"amplify.request: no resourceId provided";if(!e.publish("request.before",o)){o.error(null,"abort");return}return e.request.resources[o.resourceId](o,u),u},e.request.types={},e.request.resources={},e.request.define=function(t,n,r){if(typeof n=="string"){if(!(n in e.request.types))throw"amplify.request.define: unknown type: "+n;r.resourceId=t,e.request.resources[t]=e.request.types[n](r)}else e.request.resources[t]=n}})(amplify),function(e,t,n){var r=["status","statusText","responseText","responseXML","readyState"],i=/\{([^\}]+)\}/g;e.request.types.ajax=function(s){return s=t.extend({type:"GET"},s),function(o,u){function m(e,i){t.each(r,function(e,t){try{v[t]=a[t]}catch(n){}}),/OK$/.test(v.statusText)&&(v.statusText="success"),e===n&&(e=null),d&&(i="abort"),/timeout|error|abort/.test(i)?v.error(e,i):v.success(e,i),m=t.noop}var a,f=s.url,l=o.data,c=u.abort,h={},p=[],d=!1,v={readyState:0,setRequestHeader:function(e,t){return a.setRequestHeader(e,t)},getAllResponseHeaders:function(){return a.getAllResponseHeaders()},getResponseHeader:function(e){return a.getResponseHeader(e)},overrideMimeType:function(e){return a.overrideMideType(e)},abort:function(){d=!0;try{a.abort()}catch(e){}m(null,"abort")},success:function(e,t){o.success(e,t)},error:function(e,t){o.error(e,t)}};typeof l!="string"&&(l=t.extend(!0,{},s.data,l),f=f.replace(i,function(e,t){if(t in l)return p.push(t),l[t]}),t.each(p,function(e,t){delete l[t]})),t.extend(h,s,{url:f,type:s.type,data:"json_string"in l?l.json_string:l,dataType:s.dataType,success:function(e,t){m(e,t)},error:function(e,t){m(null,t)},beforeSend:function(t,n){a=t,h=n;var r=s.beforeSend?s.beforeSend.call(this,v,h):!0;return r&&e.publish("request.before.ajax",s,o,h,v)}}),t.ajax(h),u.abort=function(){v.abort(),c.call(this)}}};var s=e.request.cache={_key:function(e,t,n){function o(){return n.charCodeAt(i++)<<24|n.charCodeAt(i++)<<16|n.charCodeAt(i++)<<8|n.charCodeAt(i++)<<0}n=t+n;var r=n.length,i=0,s=o();while(i<r)s^=o();return"request-"+e+"-"+s},_default:function(){var e={};return function(t,n,r,i){var o=s._key(n.resourceId,r.url,r.data),u=t.cache;if(o in e)return i.success(e[o]),!1;var a=i.success;i.success=function(t){e[o]=t,typeof u=="number"&&setTimeout(function(){delete e[o]},u),a.apply(this,arguments)}}}()};e.store&&(t.each(e.store.types,function(t){s[t]=function(n,r,i,o){var u=s._key(r.resourceId,i.url,i.data),a=e.store[t](u);if(a)return i.success(a),!1;var f=o.success;o.success=function(r){e.store[t](u,r,{expires:n.cache.expires}),f.apply(this,arguments)}}}),s.persist=s[e.store.type]),e.subscribe("request.before.ajax",function(e){var t=e.cache;if(t)return t=t.type||t,s[t in s?t:"_default"].apply(this,arguments)}),e.request.decoders={jsend:function(e,t,n,r,i){e.status==="success"?r(e.data):e.status==="fail"?i(e.data,"fail"):e.status==="error"&&(delete e.status,i(e,"error"))}},e.subscribe("request.before.ajax",function(n,r,i,s){function f(e,t){o(e,t)}function l(e,t){u(e,t)}var o=s.success,u=s.error,a=t.isFunction(n.decoder)?n.decoder:n.decoder in e.request.decoders?e.request.decoders[n.decoder]:e.request.decoders._default;if(!a)return;s.success=function(e,t){a(e,t,s,f,l)},s.error=function(e,t){a(e,t,s,f,l)}})}(amplify,jQuery);
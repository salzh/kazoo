winkstart.module("core","layout",{css:["../../../config/css/welcome.css","css/layout.css","css/icons.css","css/popups.css","css/trunkstore_popups.css","css/jquery.override.css","css/popover.css","css/whapp.css"],templates:{layout:"tmpl/layout.html",layout_welcome:"tmpl/layout_welcome.html",left_welcome:"../../../config/tmpl/left_welcome.html",not_supported_browsers:"tmpl/not_supported_browsers.html"},subscribe:{"layout.detect_logo":"detect_and_set_logo","layout.render_welcome":"render_welcome"},resources:{"layout.get_logo":{url:"{api_url}/whitelabel/{domain}/logo",contentType:"application/json",dataType:"text",verb:"GET"},"layout.get_icon":{url:"{api_url}/whitelabel/{domain}/icon",contentType:"application/json",dataType:"text",verb:"GET"}}},function(e){var t=this;winkstart.registerResources("auth",t.config.resources),t.parent=e.parent||$("body"),document.title=winkstart.config.company_name||" WinkStart",t.attach(),$.cookie("c_winkstart_auth")||"c"in URL_DATA&&"a"in URL_DATA&&"f"in URL_DATA||t.render_welcome(),$("#ws-topbar .links .help").click(function(){winkstart.publish("nav.my_help_click")}),$("#ws-topbar .links .logout").click(function(){winkstart.publish("nav.my_logout_click")}),"nav"in winkstart.config&&(("help"in winkstart.config.nav||"my_help"in winkstart.config.nav)&&$("#ws-topbar .links .help").unbind("click").attr("href",winkstart.config.nav.help||winkstart.config.nav.my_help),("logout"in winkstart.config.nav||"my_logout"in winkstart.config.nav)&&$("#ws-topbar .links .logout").unbind("click").attr("href",winkstart.config.nav.logout||winkstart.config.nav.my_logout)),t.detect_and_set_logo(),winkstart.log("Layout: Initialized layout.")},{attach:function(){var e=this,t,n=URL.match(/^(?:https?:\/\/)*([^\/?#]+).*$/)[1],r=e.templates.layout.tmpl({_t:function(e){return window.translate.layout[e]}}).appendTo(e.parent),i=winkstart.config.whitelabel_api_url||winkstart.apps.auth.api_url;winkstart.config.hide_powered&&$("#powered",r).remove(),$("#loading").ajaxStart(function(){$("#loading .close-button").hide(),$(this).show(),t=setTimeout(function(){$("#loading").is(":visible")&&$("#loading .close-button").show()},1e4)}).ajaxStop(function(){$(this).hide(),clearTimeout(t)}).ajaxError(function(){$.active===0&&($(this).hide(),clearTimeout(t))}),$("#loading .close-button").click(function(){$("#loading").hide(),clearTimeout(t),$.active>0&&$.active--}),winkstart.get_version(function(e){$(".footer_wrapper .tag_version").html("("+e+")"),winkstart.config.version=e}),$("#ws-topbar .brand.logo",r).click(function(){$.cookie("c_winkstart_auth")&&($(".whapps .whapp > a").removeClass("activate"),winkstart.publish("auth.landing"))}),winkstart.request("layout.get_logo",{api_url:i,domain:n},function(e,t){$("#ws-topbar .brand.logo",r).css("background-image","url("+i+"/whitelabel/"+n+"/logo?_="+(new Date).getTime()+")")},function(e,t){t!=404?$("#ws-topbar .brand.logo",r).css("background-image",""):$("#ws-topbar .brand.logo",r).css("background-image","url(config/images/logo.png)")}),winkstart.request("layout.get_icon",{api_url:i,domain:n},function(e,t){var r=i+"/whitelabel/"+n+"/icon?_="+(new Date).getTime();winkstart.changeFavIcon(r)},function(e,t){var n=winkstart.config.favicon||"img/wsLogo.png";winkstart.changeFavIcon(n)})},render_welcome:function(e){var t=this;layout_welcome_html=t.templates.layout_welcome.tmpl().appendTo($("#ws-content"));var n={company_name:winkstart.config.company_name,company_website:winkstart.config.company_website,learn_more:winkstart.config.nav.learn_more||"http://www.2600hz.com/",_t:function(e){return window.translate.layout[e]}};t.templates.left_welcome.tmpl(n).appendTo($(".welcome-page-top .left_div",layout_welcome_html)),e&&e.callback&&e.callback()},detect_and_set_logo:function(){var e=URL.match(/^(?:https?:\/\/)*([^\/?#]+).*$/)[1],t=e.split("."),n=t.slice(1).join("."),r=$(".header > .logo > .img"),i="config/images/logos/",s;if(typeof winkstart.config.base_urls=="object"){if(e in winkstart.config.base_urls&&winkstart.config.base_urls[e].custom_logo)return s=t.join("_")+".png",r.css("background-image","url("+i+s+")"),!0;if(n in winkstart.config.base_urls&&winkstart.config.base_urls[n].custom_logo)return s=t.slice(1).join("_")+".png",r.css("background-image","url("+i+s+")"),!0}r.css("background-image","url(config/images/logo.png)")}});
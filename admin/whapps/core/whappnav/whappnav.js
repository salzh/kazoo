winkstart.module("core","whappnav",{css:["css/whappnav.css"],templates:{whapp:"tmpl/whapp.html",whapp_divider:"tmpl/whapp_divider.html",module:"tmpl/module.html",module_divider:"tmpl/module_divider.html",category:"tmpl/category.html"},subscribe:{"whappnav.add":"add","whappnav.subnav.add":"sub_add","whappnav.subnav.show":"show_menu","whappnav.subnav.hide":"hide_menu","whappnav.subnav.disable":"disable_whapp","whappnav.subnav.enable":"enable_whapp"},targets:{nav_bar:"#ws-topbar .whapps"}},function(){var e=this,t=$(e.config.targets.nav_bar),n=e.templates.whapp_divider.tmpl();t.append(n)},{add:function(e){var t=this,n=!1,r=$(t.config.targets.nav_bar),i=t.templates.whapp.tmpl({name:e.name,whapp:winkstart.apps[e.name],weight:e.weight||0}),s=t.templates.whapp_divider.tmpl();$("> a",i).click(function(t){t.preventDefault(),i.hasClass("disabled")||($(".whapps .whapp > a").removeClass("activate"),$(this).addClass("activate"),winkstart.publish(e.name+".activate",{}))}),i.hoverIntent({sensitivity:1,interval:40,timeout:200,over:function(){i.dataset("dropdown")&&!i.hasClass("disabled")&&i.addClass("open")},out:function(){i.dataset("dropdown")&&i.removeClass("open")}}),$(".whapp",r).each(function(t){var o=$(this).dataset("weight");if(e.weight<o)return $(this).before(i).before(s),n=!0,!1;if(t>=$(".whapp",r).length-1)return $(this).after(i).after(s),n=!0,!1}),n||r.prepend(i).prepend(s);var o=$("body > .topbar"),u=o.data("nb")||0;o.data("nb",u+1),o.data("nb")>6&&o.css({"min-width":"+= 140"})},disable_whapp:function(e){var t=this,n=$(t.config.targets.nav_bar);$("li[data-whapp="+e+"]",n).addClass("disabled")},enable_whapp:function(e){var t=this,n=$(t.config.targets.nav_bar);$("li[data-whapp="+e+"]",n).removeClass("disabled")},show_menu:function(e){var t=this,n=$(t.config.targets.nav_bar),r=$('.whapp[data-whapp="'+e+'"]',n);r.dataset("dropdown")&&r.addClass("open")},hide_menu:function(e){var t=this,n=$(t.config.targets.nav_bar),r=$('.whapp[data-whapp="'+e+'"]',n);r.dataset("dropdown")&&r.removeClass("open")},sub_add:function(e){var t=this,n=$(t.config.targets.nav_bar),r=$('.whapp[data-whapp="'+e.whapp+'"]',n),i=$("> .dropdown-menu",r),s=$('.module[data-category="'+(e.category||"")+'"]',i),o=t.templates.module.tmpl(e),u=!1,a,f;t.ensure_dropdown(r),$("> a",o).click(function(t){t.preventDefault(),$(".whapps .whapp > a").removeClass("activate"),$(this).parents(".whapp").find("a").addClass("activate"),winkstart.publish(e.whapp+".module_activate",{name:e.module})}),s.each(function(t){var n=$(this).dataset("weight");if(e.weight<n)return $(this).before(o),u=!0,!1;if(t>=s.length-1)return $(this).after(o),u=!0,!1}),u||(e.category?(a=t.templates.module_divider.tmpl(),f=t.templates.category.tmpl({name:e.category,label:e.category[0].toUpperCase()+e.category.slice(1),icon:e.category}),f.hoverIntent({sensitivity:1,interval:40,timeout:200,over:function(){f.dataset("dropdown")&&f.addClass("open")},out:function(){f.dataset("dropdown")&&f.removeClass("open")}}),$(".dropdown-menu",f).prepend(o),i.append(a).append(f)):i.prepend(o)),$(".category > .dropdown-menu",i).css("left",i.width())},ensure_dropdown:function(e){$("> a",e).addClass("dropdown-toggle"),e.addClass("dropdown").dataset("dropdown","dropdown")}});
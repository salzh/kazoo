!function(e){var t=0;defaultOptions={bigBtnText:"Select a file",btnText:"Select a file",inputOnly:!1,multiple:!1,resultType:"[]",dataFormat:"dataURL"},e.fn.fileUpload=function(i){var a=i&&i.hasOwnProperty("success")?i.success:void 0,n=i&&i.hasOwnProperty("error")?i.error:void 0,l=e.extend({},defaultOptions,i),r=e(this).css("display","none").prop("multiple",l.multiple),s=e('<div id="file_upload_wrapper_'+ ++t+'">'),o=e('<input type="text" id="file_upload_input_'+t+'">'),u=e('<button type="button" id="file_upload_button_'+t+'">'+l.btnText+"</button>"),p=e('<button type="button" id="file_upload_bigButton_'+t+'">'+l.bigBtnText+"</button>");l.hasOwnProperty("btnClass")&&u.addClass(l.btnClass),l.hasOwnProperty("inputClass")&&o.addClass(l.inputClass),l.hasOwnProperty("bigBtnClass")&&p.addClass(l.bigBtnClass),l.hasOwnProperty("wrapperClass")&&s.addClass(l.wrapperClass),l.inputOnly||l.hasOwnProperty("filesList")&&l.filesList.length>0?(l.hasOwnProperty("filesList")&&l.filesList.length>0&&o.val(l.filesList.join(", ")),s.insertAfter(r).append(r,o,u)):(s.insertAfter(r).append(r,o,u),p.insertBefore(s),s.hide(),e("body").delegate("#file_upload_bigButton_"+t,"click",function(){r.focus().trigger("click")})),s.delegate("#file_upload_button_"+t,"click",function(){r.focus().trigger("click")}),s.delegate('input[type="file"]',"change",function(e){var t,i,r=Array.prototype.slice.call(e.target.files),c=[],d=[],f=!1,g={mimeTypes:[],size:[]};if("[]"===l.resultType?t=[]:"{}"===l.resultType&&(t={}),r.forEach(function(e){var t=!0;l.hasOwnProperty("mimeTypes")&&-1===l.mimeTypes.indexOf(e.type)&&(g.mimeTypes.push(e.name),f=!0,t=!1),l.hasOwnProperty("maxSize")&&e.size>1e6*l.maxSize&&(g.size.push(e.name),f=!0,t=!1),t&&(d.push(e),c.push(e.name))}),d.length>0){var y=d.length;if(d.forEach(function(e){var i=new FileReader;i["readAs".concat(l.dataFormat.charAt(0).toUpperCase(),l.dataFormat.slice(1))](e),i.onloadend=function(){"[]"===l.resultType?t.push({name:e.name,file:i.result}):"{}"===l.resultType&&(t[e.name]=i.result),0===--y&&(a&&a(t),u.trigger("blur"))}}),!l.inputOnly&&p.is(":visible")&&p.fadeOut(function(){s.fadeIn()}),i=c.join(", "),""!==i)if(""!==o.val()){var h=o.css("color"),b=o.css("backgroundColor");o.animate({color:b},300,function(){o.val(i),o.animate({color:h},300)})}else o.val(i)}f&&(n&&n(g),p.is(":visible")?p.trigger("blur"):u.trigger("blur"))}),s.delegate("#file_upload_input_".concat(t),"blur",function(){r.trigger("blur")}),s.delegate("#file_upload_input_".concat(t),"keydown",function(e){switch(e.which){case 8:case 46:r.replaceWith(r=r.clone(!0)),r.trigger("change"),o.val("");break;case 9:return;case 13:r.trigger("click");break;default:return!1}})}}(jQuery);
define(["require","jquery","underscore","monster","chart"],function(e){var a=e("jquery"),t=e("underscore"),r=e("monster"),o=(e("chart"),{requests:{},subscribe:{"voip.featureCodes.render":"featureCodesRender"},categories:{call_forward:["call_forward[action=activate]","call_forward[action=deactivate]","call_forward[action=toggle]","call_forward[action=update]","call_forward[action=on_busy_enable]","call_forward[action=on_busy_disable]","call_forward[action=no_answer_enable]","call_forward[action=no_answer_disable]"],hotdesk:["hotdesk[action=login]","hotdesk[action=logout]","hotdesk[action=toggle]"],parking:["park_and_retrieve","valet","retrieve"],do_not_disturb:['donotdisturb[action="enable"]','donotdisturb[action="disable"]','donotdisturb[action="toggle"]'],misc:["voicemail[action=check]",'voicemail[action="direct"]',"intercom","privacy[mode=full]","directory","time","call_waiting[action=enable]","call_waiting[action=disable]","sound_test_service","call_recording"]},featureCodesRender:function(e){var t=this,o=e.parent||a(".right-content"),n=e.callback;t.featureCodesLoadData(function(e){var c=a(r.template(t,"featureCodes-layout",{featureCodes:t.featureCodesFormatData(e)}));t.featureCodesBindEvents({parent:o,template:c,featureCodes:e}),o.empty().append(c),n&&n()})},featureCodesLoadData:function(e){var a=this;a.callApi({resource:"callflow.list",data:{accountId:a.accountId,filters:{has_key:"featurecode"}},success:function(a,t){e&&e(a.data)}})},featureCodesFormatData:function(e){var o=this,n={};return t.each(e,function(e){if(e.featurecode.hasOwnProperty("name")){var a="misc";t.find(o.categories,function(t,r){return t.indexOf(e.featurecode.name)>=0?(a=r,!0):!1}),n.hasOwnProperty(a)||(n[a]={category:o.i18n.active().featureCodes.categories[a],codes:[]}),n[a].codes.push({key:e.featurecode.name,name:o.i18n.active().featureCodes.labels[e.featurecode.name]||e.featurecode.name,number:e.featurecode.number?e.featurecode.number.replace(/\\/g,""):""})}}),r.util.sort(a.map(n,function(e){return r.util.sort(e.codes,"number"),e}),"category")},featureCodesBindEvents:function(e){var a=e.parent,t=e.template;e.featureCodes;t.find(".main-number-link").on("click",function(e){e.preventDefault();var t=a.parents("#voip_container").find(".left-menu");t.find(".category").removeClass("active"),t.find(".category#strategy").addClass("active"),a.empty(),r.pub("voip.strategy.render",{parent:a})})}});return o});
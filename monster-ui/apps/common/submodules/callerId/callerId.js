define(["require","jquery","underscore","monster","toastr"],function(e){var n=e("jquery"),r=e("underscore"),a=e("monster"),t=e("toastr"),c={requests:{},subscribe:{"common.callerId.renderPopup":"callerIdEdit"},callerIdEdit:function(e){var n=this,r={success:function(r){n.callerIdRender(r,e.callbacks)},number:e.phoneNumber};a.pub("common.numbers.editFeatures",r)},callerIdRender:function(e,c){var i,o=this,u=n(a.template(o,"callerId-layout",e.cnam||{})),l=u.find("#cnam");a.ui.validate(l,{rules:{display_name:{minlength:1,maxlength:15}}}),u.find(".save").on("click",function(n){if(n.preventDefault(),a.ui.valid(l)){var u=a.ui.getFormData("cnam");r.extend(e,{cnam:u}),""===u.display_name&&delete e.cnam.display_name,o.callerIdUpdateNumber(e.id,e,function(e){var n=a.util.formatPhoneNumber(e.data.id),r=a.template(o,"!"+o.i18n.active().callerId.successCnam,{phoneNumber:n});t.success(r),i.dialog("destroy").remove(),c.success&&c.success(e)},function(e){c.error&&c.error(e)})}}),u.find(".cancel-link").on("click",function(e){e.preventDefault(),i.dialog("destroy").remove()}),i=a.ui.dialog(u,{title:o.i18n.active().callerId.dialogTitle})},callerIdUpdateNumber:function(e,n,r,a){var t=this;t.callApi({resource:"numbers.update",data:{accountId:t.accountId,phoneNumber:encodeURIComponent(e),data:n},success:function(e,n){"function"==typeof r&&r(e)},error:function(e,n){"function"==typeof a&&a(e)}})}};return c});
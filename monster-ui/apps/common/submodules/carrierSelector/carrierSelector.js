define(["require","jquery","underscore","monster","toastr"],function(e){var r=e("jquery"),a=e("underscore"),c=e("monster"),t=e("toastr"),o={requests:{},subscribe:{"common.carrierSelector":"carrierSelectorRender","common.carrierSelector.getDescription":"carrierSelectorGetDescription"},carrierSelectorRender:function(e){var a=this,t=a.carrierSelectorFormatData(e.data),o=r(c.template(a,"carrierSelector-layout",t));a.carrierSelectorBindEvents(o,t,e.callbackAfterSave),e.container.empty().append(o)},carrierSelectorFormatData:function(e){var r=this,t=r.i18n.active().carrierSelector.useReseller.defaultFriendlyName,o=r.i18n.active().carrierSelector.useReseller.defaultHelp;c.config.whitelabel.hasOwnProperty("companyName")&&(t=c.template(r,"!"+r.i18n.active().carrierSelector.useReseller.friendlyName,{variable:c.config.whitelabel.companyName}),o=c.template(r,"!"+r.i18n.active().carrierSelector.useReseller.help,{variable:c.config.whitelabel.companyName}));var l={noMatchCallflow:e.noMatch,type:"useBlended",choices:[{friendlyName:r.i18n.active().carrierSelector.useBlended.friendlyName,help:r.i18n.active().carrierSelector.useBlended.help,value:"useBlended"},{friendlyName:t,help:o,value:"useReseller"},{friendlyName:r.i18n.active().carrierSelector.byoc.friendlyName,help:r.i18n.active().carrierSelector.byoc.help,value:"byoc"}]};if(c.config.whitelabel.hasOwnProperty("carrier")){var i=[],n={};a.each(l.choices,function(e){n[e.value]=e}),a.each(c.config.whitelabel.carrier.choices,function(e){i.push(n[e])}),l.choices=i}return 1===l.choices.length&&(l.disabled=!0),"offnet"===e.noMatch.flow.module?l.type="useBlended":"resources"===e.noMatch.flow.module&&(e.noMatch.flow.data.hasOwnProperty("hunt_account_id")?e.noMatch.flow.data.hunt_account_id===e.accountData.id?l.type="byoc":e.noMatch.flow.data.hunt_account_id===e.accountData.reseller_id?l.type="useReseller":(l.huntError="wrong_hunt_id",l.type="useBlended"):l.type="byoc"),e.carrierInfo=l,e},carrierSelectorBindEvents:function(e,a,o){var l=this,i=e,n=a.carrierInfo.type,d=a.accountData.id,s=a.accountData.reseller_id,u=a.noMatch;c.ui.tooltips(i),i.find(".carrier-choice").on("click",function(){var e=r(this),a=i.find(".carrier-save");i.find(".carrier-choice").removeClass("selected"),e.addClass("selected"),e.data("type")!==n?a.removeClass("disabled"):a.addClass("disabled")}),i.find(".carrier-save").on("click",function(){var e=r(this),a=i.find(".carrier-choice.selected").data("type");if(a!==n){var c=function(r){n=a,t.success(l.i18n.active().carrierSelector.saveSuccess),i.find(".hunt-error").remove(),e.addClass("disabled"),o&&o(r)},h={type:a,accountId:d,resellerId:s};u.hasOwnProperty("id")?(h.callflowId=u.id,l.carrierSelectorUpdateNoMatch(h,c)):l.carrierSelectorCreateNoMatch(h,c)}})},carrierSelectorCreateNoMatch:function(e,r){var a=this,t=c.config.whitelabel.hasOwnProperty("carrier")?c.config.whitelabel.carrier.choices[0]:!1,o=e.type||t||"useBlended",l=e.accountId,i=e.resellerId,n=a.carrierSelectorGetDataNoMatch(o,i);a.callApi({resource:"callflow.create",data:{accountId:l,data:n},success:function(e,a){r(e.data)}})},carrierSelectorUpdateNoMatch:function(e,r){var a=this,c=e.type,t=e.accountId,o=e.callflowId,l=e.resellerId,i=a.carrierSelectorGetDataNoMatch(c,l);a.callApi({resource:"callflow.update",data:{accountId:t,callflowId:o,data:i},success:function(e,a){r(e.data)}})},carrierSelectorGetDataNoMatch:function(e,r){var a={numbers:["no_match"],flow:{children:{},data:{},module:"offnet"}};return"useBlended"!==e&&(a.flow.module="resources","useReseller"===e&&(a.flow.data.hunt_account_id=r)),a},carrierSelectorGetDescription:function(e){var r=this,a=e.data,t=e.callback,o="",l="";"offnet"===a.noMatch.flow.module?o="useBlended":"resources"===a.noMatch.flow.module&&(o=a.noMatch.flow.data.hasOwnProperty("hunt_account_id")?a.noMatch.flow.data.hunt_account_id===a.accountData.id?"byoc":a.noMatch.flow.data.hunt_account_id===a.accountData.reseller_id?"useReseller":"useBlended":"byoc"),l=c.config.whitelabel.hasOwnProperty("companyName")&&"useReseller"===o?c.template(r,"!"+r.i18n.active().carrierSelector.useReseller.friendlyName,{variable:c.config.whitelabel.companyName}):r.i18n.active().carrierSelector[o].friendlyName,t&&t(l)}};return o});
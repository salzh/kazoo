define(["require","jquery","underscore","monster"],function(t){var e=t("jquery"),n=t("underscore"),a=t("monster"),i={requests:{},subscribe:{"common.monsterListing.render":"monsterListingRender"},monsterListingRender:function(t){var n,i=this,s=t.container,r=i.monsterListingFormatData(t),o=e(a.template(i,"monsterListing-layout",r.labels));o.find(".grid-content").append(a.template(i,r.templateName,r)),a.ui.tooltips(o,{options:{container:"body"}}),o.find(".empty-search-row").hide(),s?s.empty().append(o):n=a.ui.dialog(o,{title:r.labels.title,position:["center",20]}),i.monsterListingBindEvents(e.extend({},t,{template:o,popup:n,formattedData:r}))},monsterListingFormatData:function(t){var i=this,s=t.dataType,r={dataList:t.dataList,singleSelect:t.singleSelect};switch(s){case"numbers":r.sortedDataList=n.map(t.dataList,function(t,e){return t.phoneNumber=e,t}),a.util.sort(r.sortedDataList,"phoneNumber"),r.templateName="monsterListing-numbers";break;case"users":r.sortedDataList=n.map(t.dataList,function(t,e){return t.name=t.first_name+" "+t.last_name,t}),n.isArray(t.dataList)&&(r.dataList=n.indexBy(t.dataList,"id")),a.util.sort(r.sortedDataList),r.templateName="monsterListing-default";break;default:n.isArray(t.dataList)?(r.sortedDataList=t.dataList,r.dataList=n.indexBy(t.dataList,"id")):r.sortedDataList=n.toArray(t.dataList),a.util.sort(r.sortedDataList),r.templateName="monsterListing-default"}return s in i.i18n.active().monsterListing?r.labels=e.extend({},i.i18n.active().monsterListing[s],t.labels):r.labels=e.extend({},i.i18n.active().monsterListing["default"],t.labels),r.labels.headline=t.singleSelect?r.labels.headlineSingle:r.labels.headline,r},monsterListingBindEvents:function(t){var i=t.template,s=t.popup,r=t.formattedData,o=r.sortedDataList,l=r.dataList,d=t.cancelCallback,c=t.okCallback;i.on("keyup",".search-query",function(){var t,a=i.find(".monster-listing-box"),s=i.find(".empty-search-row");currentSearch=e(this).val().toLowerCase(),n.each(a,function(n){t=e(n),t.data("search").toLowerCase().indexOf(currentSearch)<0?t.hide():t.show()}),a.size()>0&&(a.is(":visible")?s.hide():s.show())}),i.find(".monster-listing-box:not(.no-data)").on("click",function(t){var n=e(this);if(!e(t.target).is("input, .monster-checkbox, .monster-checkbox > *")){var a=n.find("input"),i=a.prop("checked");a.prop("checked",!i).change()}}),i.find(".monster-listing-box:not(.no-data) input").on("change",function(n){t.singleSelect?(i.find(".monster-listing-box").removeClass("selected"),e(this).parents(".monster-listing-box").addClass("selected")):e(this).parents(".monster-listing-box").toggleClass("selected")}),i.find(".proceed").on("click",function(){var t=i.find(".monster-listing-box.selected"),d=o.length-t.length,m=[];n.each(t,function(t){var n=e(t).data("id");m.push(l.hasOwnProperty(n)?l[n]:n)}),m.length>0?(c&&c(m,d),s&&s.dialog("close").remove()):a.ui.alert("error",r.labels.noDataSelected)}),i.find(".cancel").on("click",function(t){s&&s.dialog("close").remove(),d&&d()})}};return i});
define(["require","jquery","underscore","monster","toastr"],function(e){var r=e("jquery"),a=e("underscore"),i=e("monster"),t=e("toastr"),o={requests:{},subscribe:{"common.failover.renderPopup":"failoverEdit"},failoverEdit:function(e){var r=this,a={success:function(a){r.failoverRender(a,e.callbacks)},number:e.phoneNumber};i.pub("common.numbers.editFeatures",a)},failoverRender:function(e,o){var n=this,l="";"failover"in e&&(l="e164"in e.failover?"number":"sip");var u,c={radio:l,failover:e.failover,phoneNumber:e.id},s=r(i.template(n,"failover-dialog",c));s.find('.failover-block[data-type="'+l+'"]').addClass("selected"),s.find('.failover-block:not([data-type="'+l+'"]) input').val(""),s.find(".failover-block input").on("keyup",function(){s.find(".failover-block").removeClass("selected"),s.find('.failover-block:not([data-type="'+r(this).parents(".failover-block").first().data("type")+'"]) input[type="text"]').val(""),r(this).parents(".failover-block").addClass("selected")}),s.find(".submit_btn").on("click",function(r){r.preventDefault();var l={failover:{}},c=s.find(".failover-block.selected").data("type");"number"===c||"sip"===c?(l.rawInput=s.find('.failover-block[data-type="'+c+'"] input').val(),l.rawInput.match(/^sip:/)?l.failover.sip=l.rawInput:l.failover.e164=l.rawInput,delete l.rawInput,a.extend(e,l),e.failover.e164||e.failover.sip?n.failoverUpdateNumber(e.id,e,function(e){var r=i.util.formatPhoneNumber(e.data.id),a=i.template(n,"!"+n.i18n.active().failover.successFailover,{phoneNumber:r});t.success(a),u.dialog("destroy").remove(),o.success&&o.success(e)},function(e){i.ui.alert(n.i18n.active().failover.errorUpdate+""+e.data.message),o.error&&o.error(e)}):i.ui.alert(n.i18n.active().failover.invalidFailoverNumber)):i.ui.alert(n.i18n.active().failover.noDataFailover)}),s.find(".remove_failover").on("click",function(r){r.preventDefault(),delete e.failover,n.failoverUpdateNumber(e.id,e,function(e){var r=i.util.formatPhoneNumber(e.data.id),a=i.template(n,"!"+n.i18n.active().failover.successRemove,{phoneNumber:r});t.success(a),u.dialog("destroy").remove(),o.success&&o.success(e)},function(e){i.ui.alert(n.i18n.active().failover.errorUpdate+""+e.data.message),o.error&&o.error(e)})}),u=i.ui.dialog(s,{title:n.i18n.active().failover.failoverTitle,width:"540px"})},failoverUpdateNumber:function(e,r,a,i){var t=this;t.callApi({resource:"numbers.update",data:{accountId:t.accountId,phoneNumber:encodeURIComponent(e),data:r},success:function(e,r){"function"==typeof a&&a(e)},error:function(e,r){"function"==typeof i&&i(e)}})}};return o});
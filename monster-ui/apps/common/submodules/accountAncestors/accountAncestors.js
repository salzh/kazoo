define(["require","jquery","underscore","monster"],function(e){var t=e("jquery"),n=(e("underscore"),e("monster")),a={requests:{},subscribe:{"common.accountAncestors.render":"accountAncestorsRender"},accountAncestorsRender:function(e){var a=this;a.accountAncestorsRequestGetData({data:{accountId:e.accountId},success:function(c){var o=c[c.length-1],s=t.extend(!0,a.accountAncestorsFormatDataToTemplate(e.entity,o),{parents:c}),u=n.template(a,"accountAncestors",s),r=n.ui.dialog(u,{title:a.accountAncestorsGeneratePopupTitle(e.entity,o)});n.ui.tooltips(r),a.accountAncestorsBindEvents({container:r,data:{account:o}})}})},accountAncestorsBindEvents:function(e){var t=e.container;t.find("#masqueradable").on("click",function(a){a.preventDefault(),n.pub("core.triggerMasquerading",{account:e.data.account,callback:function(){var e=n.apps.getActiveApp();e in n.apps&&(n.apps[e].render(),t.dialog("close"))}})})},accountAncestorsGeneratePopupTitle:function(e,t){var a=e?e.type:"account";return"number"===a?n.util.formatPhoneNumber(e.data.id):"macAddress"===a?e.data.mac_address.match(/[0-9a-f]{2}/gi).join(":"):"account"===a?t.name:void 0},accountAncestorsFormatDataToTemplate:function(e,t){var n=this,a=e?e.type:"account",c=e?e.data:void 0,o=n.i18n.active().accountAncestors.entities[a],s={};return"account"===a||("number"===a?c.hasOwnProperty("usedBy")?s.usedBy=o.usedBy.replace("{{variable}}",n.i18n.active().numbers[c.used_by]):s.usedBy=o.notUsed:"macAddress"===a&&(s.usedBy=o.usedBy.replace("{{variable}}",c.name)),s.ownedBy=o.ownedBy.replace("{{variable}}",t.name)),s},accountAncestorsRequestGetData:function(e){var t=this;n.parallel({account:function(n){t.callApi({resource:"account.get",data:{accountId:e.data.accountId},success:function(e,t){n(null,e.data)}})},parents:function(n){t.callApi({resource:"account.listParents",data:{accountId:e.data.accountId},success:function(e,t){n(null,e.data)}})}},function(t,n){n.parents.push({id:n.account.id,name:n.account.name}),e.hasOwnProperty("success")&&e.success(n.parents)})}};return a});
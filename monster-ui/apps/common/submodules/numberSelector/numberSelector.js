define(["require","jquery","underscore","monster"],function(e){var n=e("jquery"),r=e("underscore"),t=e("monster"),a={requests:{},subscribe:{"common.numberSelector.render":"numberSelectorRender"},numberSelectorRender:function(e){var r=this,a=e.container,o=n.extend({empty:r.i18n.active().numberSelector.emptyValue,remove:r.i18n.active().numberSelector.removeLink,spare:r.i18n.active().numberSelector.spareLink,buy:r.i18n.active().numberSelector.buyLink,hideNumber:!1},e.labels),u=n(t.template(r,"numberSelector-layout",{labels:o,inputName:e.inputName||"",number:e.number,noSpare:e.noSpare===!0?!0:!1,noBuy:e.noBuy===!0?!0:!1}));if(!a)throw"A container must be provided.";e.labels=o,r.numberSelectorBindEvents(n.extend({template:u},e)),a.append(u)},numberSelectorBindEvents:function(e){var a=this,o=e.template,u=e.removeCallback,c=e.spareCallback,l=e.buyCallback,i=e.globalAddNumberCallback,m=e.spareFilters,s=e.customNumbers,b=o.find(".number-selector-dropdown"),d=o.find(".number-selector-input"),p=o.find(".number-selector-displayed .number"),v=o.find(".remove-element"),f=function(e){d.val(e),p.text(t.util.formatPhoneNumber(e)),v.find(".number").text(t.util.formatPhoneNumber(e)),v.removeClass("hidden")},y=function(e){if(e&&!r.isEmpty(e)){var n=r.isArray(e)?e[0].phoneNumber:Object.keys(e)[0];f(n),i?i(n):c&&c(n)}};b.on("click",function(){b.toggleClass("open")}),b.on("blur",function(){b.removeClass("open")}),o.find(".number-selector-element").on("click",function(){switch(n(this).data("action")){case"remove":var r=d.val();d.val(""),p.text(e.labels.empty),v.addClass("hidden"),u&&u(r);break;case"spare":s?t.pub("common.monsterListing.render",{dataList:s,dataType:"numbers",singleSelect:!0,okCallback:y}):t.pub("common.numbers.dialogSpare",{accountName:t.apps.auth.currentAccount.name,accountId:a.accountId,featureFilters:m,singleSelect:!0,callback:y});break;case"buy":t.pub("common.buyNumbers",{accountId:a.accountId,searchType:"regular",callbacks:{success:function(e){i?i(e,f):l(e)}}})}})}};return a});